<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zen - Mental Health Support App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        .navbar {
            background-color: #6a5acd;
        }
        .navbar-brand, .nav-link {
            color: white !important;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .chat-container {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 10px;
        }
        .chat-message {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 10px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .user-message {
            background-color: #dcf8c6;
            margin-left: auto;
        }
        .bot-message {
            background-color: #f0f0f0;
        }
        .mood-emoji {
            font-size: 2rem;
            cursor: pointer;
            margin: 0 10px;
            transition: transform 0.2s;
        }
        .mood-emoji:hover {
            transform: scale(1.2);
        }
        .selected {
            transform: scale(1.2);
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        .breathing-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background-color: #6a5acd;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            animation: breathe 8s infinite ease-in-out;
        }
        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        .typing-dots span {
            opacity: 0;
            animation: typingDot 1.5s infinite;
            animation-fill-mode: forwards;
        }
        .typing-dots span:nth-child(1) {
            animation-delay: 0s;
        }
        .typing-dots span:nth-child(2) {
            animation-delay: 0.5s;
        }
        .typing-dots span:nth-child(3) {
            animation-delay: 1s;
        }
        @keyframes typingDot {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Zen</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#chatbot">Chatbot</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#journal">Journal</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#mood-tracker">Mood Tracker</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#breathing">Breathing Exercise</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12 text-center mb-4">
                <h1>Welcome to Zen</h1>
                <p class="lead">Your companion for mental wellness and self-care</p>
            </div>
        </div>

        <!-- Chatbot Section -->
        <section id="chatbot" class="mb-5">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3>Mental Health Support Chatbot</h3>
                    <p class="mb-0">Powered by mental health dataset</p>
                </div>
                <div class="card-body">
                    <div class="chat-container" id="chat-messages">
                        <div class="chat-message bot-message">
                            <p>Hello! I'm here to support you. How are you feeling today?</p>
                        </div>
                    </div>
                    <div id="typing-indicator" class="chat-message bot-message d-none" style="opacity: 0.7;">
                        <p><span class="typing-dots">Typing<span>.</span><span>.</span><span>.</span></span></p>
                    </div>
                    <div class="input-group mt-3">
                        <input type="text" id="user-input" class="form-control" placeholder="Type your message...">
                        <button class="btn btn-primary" id="send-btn">Send</button>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-2">
                        <small class="text-muted">Try asking about anxiety, depression, stress management, or mental health resources.</small>
                        <button class="btn btn-sm btn-outline-secondary" id="clear-chat">Clear Chat</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Journal Section -->
        <section id="journal" class="mb-5">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h3>Daily Journal</h3>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="journal-date" class="form-label">Date</label>
                        <input type="date" class="form-control" id="journal-date">
                    </div>
                    <div class="mb-3">
                        <label for="journal-title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="journal-title" placeholder="Give your entry a title">
                    </div>
                    <div class="mb-3">
                        <label for="journal-content" class="form-label">How was your day?</label>
                        <textarea class="form-control" id="journal-content" rows="6" placeholder="Write your thoughts here..."></textarea>
                    </div>
                    <div class="d-flex justify-content-between">
                        <button class="btn btn-outline-secondary" id="load-entry">Load Previous</button>
                        <button class="btn btn-success" id="save-journal">Save Entry</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mood Tracker Section -->
        <section id="mood-tracker" class="mb-5">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h3>Mood Tracker</h3>
                </div>
                <div class="card-body">
                    <h4 class="text-center mb-4">How are you feeling today?</h4>
                    <div class="d-flex justify-content-center mb-4">
                        <span class="mood-emoji" data-mood="1">üò¢</span>
                        <span class="mood-emoji" data-mood="2">üòï</span>
                        <span class="mood-emoji" data-mood="3">üòê</span>
                        <span class="mood-emoji" data-mood="4">üôÇ</span>
                        <span class="mood-emoji" data-mood="5">üòÑ</span>
                    </div>
                    <div class="mb-3">
                        <label for="mood-notes" class="form-label">Notes (optional)</label>
                        <textarea class="form-control" id="mood-notes" rows="3" placeholder="What contributed to your mood today?"></textarea>
                    </div>
                    <div class="text-center">
                        <button class="btn btn-warning" id="save-mood">Save Mood</button>
                    </div>
                    <div class="mt-4">
                        <h5>Your Mood History</h5>
                        <canvas id="mood-chart" height="200"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Breathing Exercise Section -->
        <section id="breathing" class="mb-5">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h3>Breathing Exercise</h3>
                </div>
                <div class="card-body text-center">
                    <p class="lead mb-4">Take a moment to breathe and relax</p>
                    <div class="breathing-circle" id="breathing-circle">
                        <span id="breathing-text">Breathe In</span>
                    </div>
                    <div class="mt-4">
                        <button class="btn btn-info" id="start-breathing">Start Exercise</button>
                        <button class="btn btn-outline-secondary d-none" id="stop-breathing">Stop</button>
                    </div>
                    <div class="mt-3">
                        <p>Follow the circle as it expands and contracts. Breathe in as it grows, and out as it shrinks.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-5">
        <p>Zen &copy; 2025 - Your Mental Health Companion</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Mental Health Dataset
        let mentalHealthDataset = [];
        
        // Function to load the dataset from Hugging Face
        async function loadMentalHealthDataset() {
            try {
                const response = await fetch('https://huggingface.co/datasets/heliosbrahma/mental_health_chatbot_dataset/resolve/main/data/train-00000-of-00001.parquet');
                
                if (!response.ok) {
                    throw new Error('Failed to fetch dataset');
                }
                
                // Since we can't directly parse Parquet in browser, we'll use a fallback approach
                // In a production app, you would host this data on your server in JSON format
                // For now, we'll use a comprehensive dataset with intents and responses
                mentalHealthDataset = [
                    // Original dataset entries
                    {
                        question: "I've been feeling really down lately. What should I do?",
                        answer: "I'm sorry to hear you're feeling down. It's important to take care of your mental health. Consider talking to a trusted friend or family member about your feelings. Regular exercise, adequate sleep, and healthy eating can also help improve your mood. If these feelings persist, please consider speaking with a mental health professional who can provide proper guidance and support."
                    },
                    {
                        question: "What are the symptoms of anxiety?",
                        answer: "Anxiety symptoms can include excessive worry, restlessness, feeling on edge, fatigue, difficulty concentrating, irritability, muscle tension, and sleep problems. Physical symptoms may include increased heart rate, rapid breathing, sweating, trembling, and gastrointestinal issues. If you're experiencing these symptoms regularly, consider speaking with a healthcare provider."
                    },
                    {
                        question: "How can I manage stress?",
                        answer: "Managing stress involves several strategies: practice deep breathing and meditation, exercise regularly, maintain a healthy diet, ensure adequate sleep, limit caffeine and alcohol, practice time management, connect with supportive people, engage in activities you enjoy, and consider professional help if stress becomes overwhelming."
                    },
                    // New dataset entries from the provided intents
                    {
                        question: "Hi",
                        answer: "Hello there. Tell me how are you feeling today?"
                    },
                    {
                        question: "Hey",
                        answer: "Hi there. What brings you here today?"
                    },
                    {
                        question: "Hello",
                        answer: "Hi there. How are you feeling today?"
                    },
                    {
                        question: "Good morning",
                        answer: "Good morning. I hope you had a good night's sleep. How are you feeling today?"
                    },
                    {
                        question: "Good afternoon",
                        answer: "Good afternoon. How is your day going?"
                    },
                    {
                        question: "Good evening",
                        answer: "Good evening. How has your day been?"
                    },
                    {
                        question: "Good night",
                        answer: "Good night. Get some proper sleep. Sweet dreams."
                    },
                    {
                        question: "Bye",
                        answer: "See you later. Have a nice day."
                    },
                    {
                        question: "Thank you",
                        answer: "Happy to help! Any time!"
                    },
                    {
                        question: "Who are you?",
                        answer: "I'm Zen, your Personal Therapeutic AI Assistant. How are you feeling today?"
                    },
                    {
                        question: "What can you do?",
                        answer: "I can provide general advice regarding anxiety and depression, answer questions related to mental health and make daily conversations. Do not consider me as a substitute for an actual mental healthcare worker. Please seek help if you don't feel satisfied with me."
                    },
                    {
                        question: "I am feeling lonely",
                        answer: "I'm sorry to hear that. I'm here for you. Talking about it might help. So, tell me why do you think you're feeling this way?"
                    },
                    {
                        question: "I am so stressed",
                        answer: "What do you think is causing this? Take a deep breath and gather your thoughts. Go take a walk if possible. Stay hydrated."
                    },
                    {
                        question: "I feel so worthless",
                        answer: "It's only natural to feel this way. Tell me more. What else is on your mind? I first want to let you know that you are not alone in your feelings and there is always someone there to help. You can always change your feelings and change your way of thinking by being open to trying to change."
                    },
                    {
                        question: "I am so depressed",
                        answer: "It helps to talk about what's happening. You're going to be okay. Talk to me. Tell me more. It helps if you open up yourself to someone else."
                    },
                    {
                        question: "I feel happy",
                        answer: "That's great to hear. I'm glad you're feeling this way. Did something happen which made you feel this way?"
                    },
                    {
                        question: "I feel so anxious",
                        answer: "Don't be hard on yourself. What's the reason behind this? Can you tell me more about this feeling? I understand that it can be scary. Tell me more about it."
                    },
                    {
                        question: "I have insomnia",
                        answer: "What do you think is the reason behind this? That seems awful. What do you think is behind this?"
                    },
                    {
                        question: "I'm scared",
                        answer: "It's only natural to feel this way. I'm here for you. It'll all be okay. This feeling is only momentary."
                    },
                    {
                        question: "My family member died",
                        answer: "I'm sorry to hear that. If you want to talk about it. I'm here. My condolences. I'm here if you need to talk."
                    },
                    {
                        question: "I want to kill myself",
                        answer: "I'm very sorry to hear that but you have so much to look forward to. Please seek help by contacting a mental health crisis hotline immediately. In the US, you can call 988 for the Suicide and Crisis Lifeline."
                    },
                    {
                        question: "What is depression?",
                        answer: "Depression is a common and serious medical illness that negatively affects how you feel, the way you think and how you act. Fortunately, it is also treatable. Depression causes feelings of sadness and/or a loss of interest in activities you once enjoyed. It can lead to a variety of emotional and physical problems and can decrease your ability to function at work and at home."
                    },
                    {
                        question: "What are the types of depression?",
                        answer: "There are many different forms of depression but most common types are clinical depression, persistent depressive disorder, bipolar disorder, and postnatal disorder."
                    },
                    {
                        question: "What are the causes of depression?",
                        answer: "It's complicated, and there are multiple causes of major depression. Factors such as genetic vulnerability, severe life stressors, substances you may take (some medications, drugs and alcohol) and medical conditions can affect the way your brain regulates your moods."
                    },
                    {
                        question: "What is the difference between sadness and depression?",
                        answer: "Sadness is a normal reaction to a loss, disappointment, problems, or other difficult situations. Feeling sad from time to time is just another part of being human. Depression is a mental illness that affects your mood, the way you understand yourself, and the way you understand and relate to things around you. Depression lasts longer than two weeks, doesn't usually go away on its own, and impacts your life."
                    },
                    {
                        question: "What is anxiety?",
                        answer: "Anxiety is your body's natural response to stress. It's a feeling of fear or apprehension about what's to come. The first day of school, going to a job interview, or giving a speech may cause most people to feel fearful and nervous. But if your feelings of anxiety are extreme, last for longer than six months, and are interfering with your life, you may have an anxiety disorder."
                    },
                    {
                        question: "What's the difference between anxiety and stress?",
                        answer: "Stress and anxiety are often used interchangeably, and there is overlap between stress and anxiety. Stress focuses on mainly external pressures on us that we're finding hard to cope with. When we are stressed, we usually know what we're stressed about, and the symptoms of stress typically disappear after the stressful situation is over. Anxiety, on the other hand, isn't always as easy to figure out and may persist even when the stressor is gone."
                    },
                    {
                        question: "How can I reduce anxiety?",
                        answer: "The 3-3-3 rule is a helpful method to reduce anxiety. In this method, you mentally note three things you see, three sounds you hear, and then move three parts of your body. This exercise can help your mind refocus on something else and break the cycle of anxious thoughts."
                    },
                    {
                        question: "How can I maintain social connections?",
                        answer: "To maintain social connections: schedule regular video chats or phone calls with friends and family, join online communities based on your interests, participate in virtual events, reach out to check on others, share meaningful activities even at a distance, write letters or emails, and be open about your own need for connection."
                    },
                    {
                        question: "I feel I have let my parents down",
                        answer: "No matter what, your parents will always be proud of you and will love you. You will feel much better if you share your feelings with them."
                    },
                    {
                        question: "I am good for nothing",
                        answer: "Don't ever think you cannot achieve what you want. You are capable of reaching your goals. Here is a quote for you: 'Everything you can imagine is real.'"
                    },
                    {
                        question: "I am afraid I will fail again",
                        answer: "Failure is the stepping stone towards success. Never fear failure. Your hard work and determination will help you reach your goal."
                    }
                ];
                
                console.log('Mental health dataset loaded successfully');
            } catch (error) {
                console.error('Error loading mental health dataset:', error);
            }
        }
        
        // Load the dataset when the page loads
        window.addEventListener('DOMContentLoaded', loadMentalHealthDataset);
        
        // Chatbot functionality
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const typingIndicator = document.getElementById('typing-indicator');
            const clearChatBtn = document.getElementById('clear-chat');
            
            // Store conversation history
            let conversationHistory = [
                { role: 'bot', message: 'Hello! I\'m here to support you. How are you feeling today?' }
            ];
            
            // Context tracking for more personalized responses
            let userContext = {
                mentionedAnxiety: false,
                mentionedDepression: false,
                mentionedStress: false,
                mentionedSleep: false,
                mentionedSuicide: false,
                recentTopics: []
            };
            
            // Function to update user context based on message
            function updateUserContext(message) {
                const messageLower = message.toLowerCase();
                
                // Track mentioned conditions
                if (messageLower.includes('anxiety') || messageLower.includes('anxious') || messageLower.includes('worried') || messageLower.includes('nervous')) {
                    userContext.mentionedAnxiety = true;
                }
                if (messageLower.includes('depression') || messageLower.includes('depressed') || messageLower.includes('hopeless') || messageLower.includes('worthless')) {
                    userContext.mentionedDepression = true;
                }
                if (messageLower.includes('stress') || messageLower.includes('stressed') || messageLower.includes('overwhelmed') || messageLower.includes('pressure')) {
                    userContext.mentionedStress = true;
                }
                if (messageLower.includes('sleep') || messageLower.includes('insomnia') || messageLower.includes('tired') || messageLower.includes('fatigue') || messageLower.includes('exhausted')) {
                    userContext.mentionedSleep = true;
                }
                
                // Track suicidal thoughts for immediate attention
                if (messageLower.includes('suicide') || messageLower.includes('kill myself') || messageLower.includes('want to die') || messageLower.includes('end my life')) {
                    userContext.mentionedSuicide = true;
                }
                
                // Track recent topics (keep last 5)
                const topics = [
                    'anxiety', 'depression', 'stress', 'sleep', 'therapy', 
                    'medication', 'exercise', 'mindfulness', 'breathing',
                    'family', 'work', 'school', 'relationship', 'friend',
                    'lonely', 'sad', 'happy', 'angry', 'scared', 'worried',
                    'hopeless', 'worthless', 'tired', 'exhausted', 'energetic',
                    'motivated', 'unmotivated', 'suicidal', 'crisis', 'help',
                    'support', 'coping', 'self-care', 'relaxation', 'panic',
                    'trauma', 'grief', 'loss', 'change', 'future', 'past',
                    'present', 'mindful', 'grateful', 'thankful', 'appreciation'
                ];
                
                for (const topic of topics) {
                    if (messageLower.includes(topic) && !userContext.recentTopics.includes(topic)) {
                        userContext.recentTopics.unshift(topic);
                        if (userContext.recentTopics.length > 5) {
                            userContext.recentTopics.pop();
                        }
                    }
                }
                
                // Store context in localStorage
                localStorage.setItem('userContext', JSON.stringify(userContext));
            }
            
            // Function to add a message to the chat
            function addMessage(message, isUser) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${isUser ? 'user-message' : 'bot-message'}`;
                messageDiv.innerHTML = `<p>${message}</p>`;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Update context if it's a user message
                if (isUser) {
                    updateUserContext(message);
                }
                
                // Add to conversation history
                conversationHistory.push({
                    role: isUser ? 'user' : 'bot',
                    message: message
                });
                
                // Store in localStorage (limited to last 50 messages)
                if (conversationHistory.length > 50) {
                    conversationHistory = conversationHistory.slice(-50);
                }
                localStorage.setItem('chatHistory', JSON.stringify(conversationHistory));
            }
            
            // Function to find the best response from the dataset with context awareness
            function findBestResponse(userMessage) {
                userMessage = userMessage.toLowerCase();
                
                // Calculate similarity scores for each dataset entry
                const scoredResponses = mentalHealthDataset.map(entry => {
                    const questionLower = entry.question.toLowerCase();
                    
                    // Calculate a simple similarity score
                    let score = 0;
                    
                    // Check for exact phrase matches (highest weight)
                    if (questionLower.includes(userMessage) || userMessage.includes(questionLower)) {
                        score += 10;
                    }
                    
                    // Check for word matches
                    const userWords = userMessage.split(/\s+/);
                    const questionWords = questionLower.split(/\s+/);
                    
                    userWords.forEach(word => {
                        if (word.length > 3 && questionWords.includes(word)) {
                            score += 3;
                        }
                    });
                    
                    // Check for keyword matches
                    const keywords = [
                        'anxiety', 'depression', 'stress', 'sad', 'therapy', 'mental',
                        'panic', 'sleep', 'worried', 'fear', 'mood', 'emotion', 'feeling',
                        'psychiatrist', 'psychologist', 'counselor', 'medication', 'treatment',
                        'hello', 'hi', 'hey', 'morning', 'afternoon', 'evening', 'night',
                        'bye', 'goodbye', 'thanks', 'thank', 'lonely', 'worthless', 'scared',
                        'suicide', 'kill', 'die', 'death', 'insomnia', 'happy', 'good', 'bad',
                        'parents', 'family', 'friend', 'relationship', 'work', 'school',
                        'fail', 'success', 'achieve', 'goal', 'mind', 'brain', 'think',
                        'thought', 'feel', 'emotion', 'connection', 'social', 'alone'
                    ];
                    
                    keywords.forEach(keyword => {
                        if (userMessage.includes(keyword) && questionLower.includes(keyword)) {
                            score += 5;
                        }
                    });
                    
                    // Boost score based on user context
                    if (userContext.mentionedAnxiety && questionLower.includes('anxiety')) {
                        score += 2;
                    }
                    if (userContext.mentionedDepression && questionLower.includes('depression')) {
                        score += 2;
                    }
                    if (userContext.mentionedStress && questionLower.includes('stress')) {
                        score += 2;
                    }
                    if (userContext.mentionedSleep && questionLower.includes('sleep')) {
                        score += 2;
                    }
                    
                    // Boost score for recent topics
                    userContext.recentTopics.forEach((topic, index) => {
                        if (questionLower.includes(topic)) {
                            // Give higher boost to more recent topics
                            score += (3 - index);
                        }
                    });
                    
                    // Special handling for greetings
                    if ((userMessage.includes('hi') || userMessage.includes('hello') || userMessage.includes('hey')) && 
                        (questionLower.includes('hi') || questionLower.includes('hello') || questionLower.includes('hey'))) {
                        score += 8;
                    }
                    
                    // Special handling for time-specific greetings
                    const currentHour = new Date().getHours();
                    if (currentHour >= 5 && currentHour < 12 && userMessage.includes('morning') && questionLower.includes('morning')) {
                        score += 10;
                    } else if (currentHour >= 12 && currentHour < 17 && userMessage.includes('afternoon') && questionLower.includes('afternoon')) {
                        score += 10;
                    } else if (currentHour >= 17 && currentHour < 22 && userMessage.includes('evening') && questionLower.includes('evening')) {
                        score += 10;
                    } else if ((currentHour >= 22 || currentHour < 5) && userMessage.includes('night') && questionLower.includes('night')) {
                        score += 10;
                    }
                    
                    // Special handling for suicidal thoughts - highest priority
                    if ((userMessage.includes('kill myself') || userMessage.includes('suicide') || userMessage.includes('want to die')) && 
                        (questionLower.includes('kill myself') || questionLower.includes('suicide'))) {
                        score += 50;
                    }
                    
                    return { entry, score };
                });
                
                // Sort by score (highest first)
                scoredResponses.sort((a, b) => b.score - a.score);
                
                // If we have a good match (score > 0), use it
                if (scoredResponses.length > 0 && scoredResponses[0].score > 0) {
                    return scoredResponses[0].entry.answer;
                }
                
                // Fallback to keyword-based responses
                const responses = {
                    'hello': 'Hi there! How can I help you today?',
                    'hi': 'Hello! How are you feeling?',
                    'hey': 'Hey there! How are you doing today?',
                    'sad': 'I\'m sorry to hear you\'re feeling sad. Remember that it\'s okay to feel this way, and these feelings will pass. Would you like to try a breathing exercise?',
                    'anxious': 'Anxiety can be challenging. Have you tried grounding techniques? Focus on 5 things you can see, 4 things you can touch, 3 things you can hear, 2 things you can smell, and 1 thing you can taste.',
                    'stressed': 'Stress affects us all. Consider taking a short break to practice mindfulness or try our breathing exercise.',
                    'happy': 'That\'s wonderful to hear! Celebrating positive emotions is just as important as managing difficult ones.',
                    'tired': 'Rest is essential for mental health. Make sure you\'re getting enough sleep and taking breaks when needed.',
                    'help': 'I\'m here to support you. You can talk about your feelings, use our journal to express yourself, track your mood, or try a breathing exercise.',
                    'thank': 'You\'re welcome! I\'m here anytime you need support.',
                    'bye': 'Take care! Remember I\'m here whenever you need to talk.',
                    'depressed': 'I\'m sorry you\'re feeling this way. Depression is treatable, and reaching out is a brave first step. Would you like to talk more about what you\'re experiencing?',
                    'lonely': 'Feeling lonely can be really difficult. Remember that you\'re not alone in feeling this way. Would you like to explore some ways to connect with others?',
                    'worthless': 'You have value and worth, even when it\'s hard to see it yourself. Your feelings are valid, but they don\'t define your worth as a person.'
                };
                
                // Check for keyword matches in our fallback responses
                for (const keyword in responses) {
                    if (userMessage.includes(keyword)) {
                        return responses[keyword];
                    }
                }
                
                // Default response if no matches
                return "I'm here to listen and support you. Could you tell me more about how you're feeling?";
            }
            
            // Show typing indicator
            function showTypingIndicator() {
                typingIndicator.classList.remove('d-none');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Hide typing indicator
            function hideTypingIndicator() {
                typingIndicator.classList.add('d-none');
            }
            
            // Send message when button is clicked
            sendBtn.addEventListener('click', function() {
                const message = userInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    userInput.value = '';
                    
                    // Show typing indicator
                    showTypingIndicator();
                    
                    // Simulate typing delay based on response length
                    setTimeout(() => {
                        hideTypingIndicator();
                        const botResponse = findBestResponse(message);
                        addMessage(botResponse, false);
                    }, Math.min(1000 + Math.random() * 1000, 3000)); // Random delay between 1-2 seconds, max 3 seconds
                }
            });
            
            // Send message when Enter key is pressed
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendBtn.click();
                }
            });
            
            // Clear chat history
            clearChatBtn.addEventListener('click', function() {
                // Confirm before clearing
                if (confirm('Are you sure you want to clear the chat history?')) {
                    // Clear chat display
                    chatMessages.innerHTML = '';
                    
                    // Reset conversation history
                    conversationHistory = [
                        { role: 'bot', message: 'Hello! I\'m here to support you. How are you feeling today?' }
                    ];
                    
                    // Reset user context
                    userContext = {
                        mentionedAnxiety: false,
                        mentionedDepression: false,
                        mentionedStress: false,
                        mentionedSleep: false,
                        mentionedSuicide: false,
                        recentTopics: []
                    };
                    
                    // Add initial message
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'chat-message bot-message';
                    messageDiv.innerHTML = '<p>Hello! I\'m here to support you. How are you feeling today?</p>';
                    chatMessages.appendChild(messageDiv);
                    
                    // Clear localStorage
                    localStorage.removeItem('chatHistory');
                    localStorage.removeItem('userContext');
                }
            });
            
            // Load conversation history from localStorage
            function loadConversationHistory() {
                const savedHistory = localStorage.getItem('chatHistory');
                if (savedHistory) {
                    try {
                        const history = JSON.parse(savedHistory);
                        
                        // Clear default message
                        chatMessages.innerHTML = '';
                        
                        // Add messages from history
                        history.forEach(item => {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = `chat-message ${item.role === 'user' ? 'user-message' : 'bot-message'}`;
                            messageDiv.innerHTML = `<p>${item.message}</p>`;
                            chatMessages.appendChild(messageDiv);
                        });
                        
                        conversationHistory = history;
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    } catch (error) {
                        console.error('Error loading chat history:', error);
                    }
                }
                
                // Load user context
                const savedContext = localStorage.getItem('userContext');
                if (savedContext) {
                    try {
                        userContext = JSON.parse(savedContext);
                    } catch (error) {
                        console.error('Error loading user context:', error);
                    }
                }
            }
            
            // Load conversation history when page loads
            loadConversationHistory();
            
            // Focus on input field when page loads
            userInput.focus();
            
            // Journal functionality
            const saveJournalBtn = document.getElementById('save-journal');
            const loadEntryBtn = document.getElementById('load-entry');
            
            saveJournalBtn.addEventListener('click', function() {
                const date = document.getElementById('journal-date').value;
                const title = document.getElementById('journal-title').value;
                const content = document.getElementById('journal-content').value;
                
                if (date && title && content) {
                    // Save to localStorage
                    const entry = { date, title, content };
                    const journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
                    journalEntries.push(entry);
                    localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                    
                    alert('Journal entry saved successfully!');
                    document.getElementById('journal-title').value = '';
                    document.getElementById('journal-content').value = '';
                } else {
                    alert('Please fill in all fields');
                }
            });
            
            loadEntryBtn.addEventListener('click', function() {
                const journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '[]');
                if (journalEntries.length > 0) {
                    const latestEntry = journalEntries[journalEntries.length - 1];
                    document.getElementById('journal-date').value = latestEntry.date;
                    document.getElementById('journal-title').value = latestEntry.title;
                    document.getElementById('journal-content').value = latestEntry.content;
                } else {
                    alert('No previous entries found');
                }
            });
            
            // Mood Tracker functionality
            const moodEmojis = document.querySelectorAll('.mood-emoji');
            const saveMoodBtn = document.getElementById('save-mood');
            let selectedMood = null;
            
            moodEmojis.forEach(emoji => {
                emoji.addEventListener('click', function() {
                    moodEmojis.forEach(e => e.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedMood = this.getAttribute('data-mood');
                });
            });
            
            saveMoodBtn.addEventListener('click', function() {
                if (selectedMood) {
                    const notes = document.getElementById('mood-notes').value;
                    const date = new Date().toISOString().split('T')[0];
                    
                    const moodEntry = { date, mood: selectedMood, notes };
                    const moodEntries = JSON.parse(localStorage.getItem('moodEntries') || '[]');
                    moodEntries.push(moodEntry);
                    localStorage.setItem('moodEntries', JSON.stringify(moodEntries));
                    
                    alert('Mood saved successfully!');
                    document.getElementById('mood-notes').value = '';
                    moodEmojis.forEach(e => e.classList.remove('selected'));
                    selectedMood = null;
                    
                    updateMoodChart();
                } else {
                    alert('Please select a mood');
                }
            });
            
            // Function to update mood chart
            function updateMoodChart() {
                const moodEntries = JSON.parse(localStorage.getItem('moodEntries') || '[]');
                
                if (moodEntries.length > 0) {
                    const ctx = document.getElementById('mood-chart').getContext('2d');
                    
                    // Get the last 7 entries or fewer if not enough
                    const recentEntries = moodEntries.slice(-7);
                    const labels = recentEntries.map(entry => entry.date);
                    const data = recentEntries.map(entry => entry.mood);
                    
                    // Create or update chart
                    if (window.moodChart) {
                        window.moodChart.data.labels = labels;
                        window.moodChart.data.datasets[0].data = data;
                        window.moodChart.update();
                    } else {
                        window.moodChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Mood Level',
                                    data: data,
                                    backgroundColor: 'rgba(106, 90, 205, 0.2)',
                                    borderColor: 'rgba(106, 90, 205, 1)',
                                    borderWidth: 2,
                                    tension: 0.3
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        min: 1,
                                        max: 5,
                                        ticks: {
                                            stepSize: 1
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
            }
            
            // Initialize mood chart
            updateMoodChart();
            
            // Breathing Exercise functionality
            const startBreathingBtn = document.getElementById('start-breathing');
            const stopBreathingBtn = document.getElementById('stop-breathing');
            const breathingCircle = document.getElementById('breathing-circle');
            const breathingText = document.getElementById('breathing-text');
            let breathingInterval;
            
            startBreathingBtn.addEventListener('click', function() {
                startBreathingBtn.classList.add('d-none');
                stopBreathingBtn.classList.remove('d-none');
                
                let phase = 'inhale';
                breathingText.textContent = 'Breathe In';
                
                breathingInterval = setInterval(() => {
                    if (phase === 'inhale') {
                        phase = 'hold';
                        breathingText.textContent = 'Hold';
                        setTimeout(() => {
                            if (phase === 'hold') {
                                phase = 'exhale';
                                breathingText.textContent = 'Breathe Out';
                            }
                        }, 2000);
                    } else if (phase === 'exhale') {
                        phase = 'inhale';
                        breathingText.textContent = 'Breathe In';
                    }
                }, 4000);
            });
            
            stopBreathingBtn.addEventListener('click', function() {
                clearInterval(breathingInterval);
                startBreathingBtn.classList.remove('d-none');
                stopBreathingBtn.classList.add('d-none');
                breathingText.textContent = 'Breathe In';
            });
            
            // Set today's date as default for journal
            document.getElementById('journal-date').valueAsDate = new Date();
        });
    </script>
</body>
</html>
